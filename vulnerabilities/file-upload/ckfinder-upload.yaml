id: ckfinder-upload

info:
  name: CKFinder File Upload Detection
  author: nuclei-templates
  severity: medium
  description: DÃ©tecte et teste les endpoints d'upload de CKFinder
  tags: ckfinder,file-upload,upload

http:
  - method: GET
    path:
      - "{{BaseURL}}/ckfinder/ckfinder.html"
      - "{{BaseURL}}/ckfinder/"
      - "{{BaseURL}}/assets/ckfinder/"
      - "{{BaseURL}}/js/ckfinder/"
      - "{{BaseURL}}/libs/ckfinder/"

    matchers:
      - type: word
        words:
          - "CKFinder"
          - "ckfinder.js"
          - "ckfinder.html"
        condition: or

  - method: POST
    path:
      - "{{BaseURL}}/ckfinder/core/connector/php/connector.php"
      - "{{BaseURL}}/ckfinder/core/connector/asp/connector.aspx"
      - "{{BaseURL}}/ckfinder/core/connector/aspx/connector.aspx"
      - "{{BaseURL}}/ckfinder/core/connector/java/connector"
      - "{{BaseURL}}/ckfinder/core/connector/cfm/connector.cfm"

    headers:
      Content-Type: multipart/form-data; boundary=----WebKitFormBoundary

    body: |
      ------WebKitFormBoundary
      Content-Disposition: form-data; name="command"

      FileUpload
      ------WebKitFormBoundary
      Content-Disposition: form-data; name="type"

      Files
      ------WebKitFormBoundary
      Content-Disposition: form-data; name="currentFolder"

      /
      ------WebKitFormBoundary
      Content-Disposition: form-data; name="newFileName"

      test.txt
      ------WebKitFormBoundary
      Content-Disposition: form-data; name="upload"; filename="test.txt"
      Content-Type: text/plain

      test
      ------WebKitFormBoundary--

    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - "fileName"
          - "uploaded"
        condition: or

